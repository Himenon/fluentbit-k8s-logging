[SERVICE]
    Flush           5
    Grace           120
    Daemon          off
    Parsers_File    parser.conf
    HTTP_Server     On
    HTTP_Listen     0.0.0.0
    HTTP_PORT       2020
    Log_Level       debug

[INPUT]
    Name            tail
    Path            /app/logs/nginx/access.log
    Tag             nginx_log

[FILTER]
    Name            parser 
    Match           nginx_log
    Key_Name        log
    Preserve_Key    true
    Reserve_Data    true
    Parser          ltsv-parser

[FILTER]
    Name            lua
    Match           nginx_log
    # https://github.com/fluent/fluent-bit/issues/2786
    script          record_date.lua
    call            record_date

[FILTER]
    Name            rewrite_tag
    Match           nginx_log
    # タグを日付ごとに切り替えることにより、出力ファイル名が変更される。このときOUTPUTはMatchを利用する必要がある
    Rule            $vhost ^(.*)$ /app/logs/$record_date.log true

[OUTPUT]
    Name            file
    Match           nginx_log
    Format          ltsv
    Path            /app/logs/fluentbit/

[OUTPUT]
    Name            stdout
    Match           /app/logs
    Format          ltsv
